# 毒生物ゲーム - 要件定義書

## 1. プロジェクト概要

### 1.1 ゲームコンセプト
プレイヤーが毒生物のキャラクターに変身し、マップ上で他のプレイヤーと競争・協力しながら成長・進化するマルチプレイヤーゲーム。

### 1.2 ターゲットユーザー
- 主なターゲット: 10代から20代のRobloxユーザー
- ゲームスタイル: カジュアル、リラックス、ソーシャル

### 1.3 開発環境
- **プラットフォーム**: Roblox
- **開発ツール**: Roblox Studio, Rojo, Wally
- **プログラミング言語**: Luau
- **プロジェクト構造**: モノレポ構造（既存プロジェクトに統合）

## 2. 機能要件

### 2.1 コアゲームプレイ機能

#### 2.1.1 キャラクターシステム
- **毒生物選択機能**
  - プレイヤーが複数の毒生物タイプから選択可能
  - 初期選択: 毒ヘビ、毒ガエル、毒サソリ、毒キノコ、毒クラゲ、毒イモリなど
  - 各毒生物タイプに固有の外観とアニメーション

- **キャラクター変身**
  - ゲーム開始時またはリスポーン時に毒生物に変身
  - プレイヤーのアバターを毒生物のモデルに置き換え
  - カスタマイズ可能な色や装飾（将来的に）

#### 2.1.2 成長・進化システム
- **サイズ成長**
  - 他の毒生物を捕食する、または毒アイテムを取得することで成長
  - サイズが大きくなるにつれて移動速度が変化（バランス調整）
  - 視覚的なサイズ変化（スケール調整）

- **進化システム**
  - 一定のサイズ/レベルに達すると進化可能
  - 進化により新しい外観や能力を獲得
  - 複数の進化段階（例: 小さな毒ヘビ → 大きな毒ヘビ → メガ毒ヘビ）

#### 2.1.3 移動・操作システム
- **基本移動**
  - WASDキーまたは矢印キーで移動
  - スペースキーでジャンプ
  - スムーズな移動アニメーション

- **特殊能力（将来的に）**
  - 各毒生物タイプに固有の特殊能力（毒攻撃、隠れ身、跳躍など）
  - クールダウンシステム

#### 2.1.4 インタラクションシステム
- **毒アイテムの取得**
  - マップ上に散らばった毒アイテムを取得
  - 他のプレイヤー（小さい場合）を捕食する可能性
  - 衝突判定と取得判定

- **環境との相互作用**
  - 障害物との衝突
  - トラップやハザード（将来的に）
  - 特別なエリア（毒の沼、安全エリア、隠れ家など）

### 2.2 マップ・環境機能

#### 2.2.1 マップ設計
- **基本マップ**
  - 広大なオープンワールド
  - 複数のエリア（ジャングル、沼地、洞窟、遺跡など）
  - 視覚的に魅力的なデザイン（暗めの雰囲気）

- **動的要素**
  - ランダムに出現する毒アイテム
  - 定期的にリスポーンするアイテム
  - 環境アニメーション（毒の泡、霧など）

#### 2.2.2 ゾーンシステム
- **安全ゾーン**
  - リスポーンエリア
  - プレイヤーが安全に開始できるエリア

- **特別なゾーン（将来的に）**
  - 成長加速ゾーン
  - ボスエリア
  - イベントエリア

### 2.3 UI/UX機能

#### 2.3.1 メインUI
- **HUD（ヘッドアップディスプレイ）**
  - 現在のサイズ/レベル表示
  - スコア表示（取得した毒アイテム数など）
  - ミニマップ（将来的に）

- **メニューUI**
  - 毒生物選択画面
  - 設定メニュー
  - 統計表示

#### 2.3.2 フィードバックシステム
- **視覚的フィードバック**
  - アイテム取得時のエフェクト
  - 成長時のアニメーション
  - 進化時の演出

- **音響フィードバック**
  - 取得音
  - 成長音
  - BGMと環境音

### 2.4 マルチプレイヤー機能

#### 2.4.1 ネットワーキング
- **同期システム**
  - プレイヤーの位置と状態の同期
  - リアルタイム更新
  - ラグ補正

- **プレイヤー間インタラクション**
  - 他のプレイヤーの表示
  - サイズ比較システム
  - チャット機能（Roblox標準）

#### 2.4.2 リスポーンシステム
- **死亡・リスポーン**
  - 大きいプレイヤーに捕食された場合のリスポーン
  - リスポーン時のサイズリセット
  - リスポーン保護時間（短時間無敵）

### 2.5 データ管理機能

#### 2.5.1 プレイヤーデータ
- **セーブデータ**
  - 最高サイズ/レベル記録
  - 総プレイ時間
  - 獲得した毒生物タイプ（将来的に）
  - ProfileStoreを使用したデータ永続化

- **統計データ**
  - 取得した毒アイテム数
  - 進化回数
  - プレイヤーを捕食した回数

#### 2.5.2 ゲーム状態管理
- **サーバー側の状態管理**
  - ゲームルールの管理
  - アイテムの生成と管理
  - プレイヤーの状態管理

## 3. 非機能要件

### 3.1 パフォーマンス要件
- **フレームレート**: 最低30FPS、目標60FPS
- **ネットワーク**: スムーズな同期（100ms以下のラグ）
- **最適化**: 大量のプレイヤー（50+）でも安定動作

### 3.2 セキュリティ要件
- **アンチチート**: クライアント側の検証をサーバー側で再検証
- **データ保護**: プレイヤーデータの改ざん防止
- **Exploit対策**: 一般的なRobloxのExploit対策

### 3.3 拡張性要件
- **モジュラー設計**: 機能追加が容易な構造
- **設定ファイル**: ゲームバランスの調整が容易
- **プラグインシステム**: 将来的な機能拡張に対応

### 3.4 ユーザビリティ要件
- **直感的な操作**: 説明なしで遊べるUI
- **多言語対応**: 日本語と英語（将来的に）
- **アクセシビリティ**: 色覚異常者への配慮

## 4. 技術仕様

### 4.1 アーキテクチャ

#### 4.1.1 クライアント・サーバー分離
- **クライアント側（Client）**
  - UI管理（Fusion使用）
  - ローカルエフェクト
  - 入力処理
  - 視覚的フィードバック

- **サーバー側（Server）**
  - ゲームロジック
  - データ管理（ProfileStore使用）
  - アイテム生成
  - バリデーション

- **共有（Shared）**
  - 型定義
  - 定数
  - ユーティリティ関数
  - 設定値

#### 4.1.2 データ同期
- **Replica Service**: サーバーとクライアント間の状態同期
- **Remote Events**: イベントベースの通信
- **Remote Functions**: リクエスト・レスポンス型の通信

### 4.2 使用ライブラリ

#### 4.2.1 既存ライブラリの活用
- **Fusion**: UI構築と状態管理
- **Replica**: データ同期
- **Promise**: 非同期処理
- **FastSignal**: イベント処理
- **ZonePlus**: エリア検出
- **Janitor/Trove**: リソース管理
- **ProfileStore**: データ永続化
- **RbxUtils**: ユーティリティ関数

#### 4.2.2 追加検討ライブラリ
- **Moonlite**: アニメーション（必要に応じて）
- **Rewire**: ホットリロード（開発時）

### 4.3 プロジェクト構造

```
venomous-creatures-experience/
├── default.project.json
├── README.md
└── src/
    ├── shared/
    │   ├── Types.luau          # 型定義
    │   ├── Constants.luau      # 定数
    │   ├── Config.luau         # ゲーム設定
    │   └── Utils/
    │       ├── CreatureTypes.luau  # 毒生物タイプ定義
    │       └── GrowthSystem.luau # 成長計算
    ├── server/
    │   ├── init.server.luau    # サーバー初期化
    │   ├── Services/
    │   │   ├── GameService.luau      # ゲームロジック
    │   │   ├── ItemSpawner.luau      # アイテム生成
    │   │   ├── PlayerManager.luau    # プレイヤー管理
    │   │   └── DataService.luau      # データ管理
    │   └── Components/
    │       └── VenomousCharacter.luau     # 毒生物キャラクター
    └── client/
        ├── init.client.luau    # クライアント初期化
        ├── Controllers/
        │   ├── MovementController.luau  # 移動制御
        │   ├── CameraController.luau    # カメラ制御
        │   └── InputController.luau     # 入力処理
        ├── UI/
        │   ├── MainUI.luau     # メインUI
        │   ├── CreatureSelector.luau # 毒生物選択UI
        │   └── HUD.luau        # HUD
        └── Effects/
            └── VisualEffects.luau # 視覚エフェクト
```

## 5. 開発フェーズ

### 5.1 フェーズ1: プロトタイプ（MVP）
**期間**: 2-3週間

**目標**: 基本的なゲームプレイを実現

**MVPの理想的な状態**:
MVP完了時点で、プレイヤーは以下の完全なゲームサイクルを体験できる状態：

1. **ゲーム開始**
   - プレイヤーがゲームに参加すると、自動的に1種類の毒生物（例: 毒ヘビ）に変身
   - 初期サイズは1.0（基準サイズ）
   - リスポーンエリアに配置される

2. **基本操作**
   - WASDキーでスムーズに移動できる
   - スペースキーでジャンプできる
   - カメラはサードパーソンビューで追従する

3. **コアゲームプレイ**
   - マップ上に散らばった毒アイテム（視覚的に識別可能なオブジェクト）を取得できる
   - アイテム取得時にサイズが成長する（視覚的に確認可能）
   - 他のプレイヤー（自分より小さい場合）に接触すると捕食できる
   - 捕食時にサイズが大きく成長する

4. **成長とリスク**
   - サイズが大きくなるにつれて移動速度が減少する（バランス調整済み）
   - 大きいプレイヤーに接触すると捕食され、リスポーンする
   - リスポーン時は初期サイズに戻る

5. **UI表示**
   - 画面上部に現在のサイズ/レベルが表示される
   - 取得した毒アイテム数が表示される
   - シンプルで見やすいデザイン

6. **マルチプレイヤー**
   - 他のプレイヤーがリアルタイムで表示される
   - プレイヤー間のサイズ差が視覚的に分かる
   - 最大50人程度が同時にプレイ可能

**実装内容（詳細）**:

#### 5.1.1 キャラクターシステム
- **最小限の実装**:
  - 1種類の毒生物タイプ（例: 毒ヘビ）のみ実装
  - プレイヤーのアバターをシンプルな毒生物モデルに置き換え
  - 基本的なアニメーション（待機、移動）
  - サイズに応じたスケール調整（0.5倍〜5倍程度）

#### 5.1.2 移動システム
- **最小限の実装**:
  - 基本的なWASD移動（CharacterControllerまたはBodyVelocity使用）
  - ジャンプ機能
  - サイズに応じた速度調整（実装済みの計算式を使用）
  - 滑らかなカメラ追従

#### 5.1.3 アイテムシステム
- **最小限の実装**:
  - シンプルな毒アイテムモデル（球体やパーティクルなど）
  - マップ上にランダムに生成（20-30個同時存在）
  - プレイヤーとの衝突判定で取得
  - 取得時にサイズが+0.1成長
  - 取得エフェクト（パーティクルや音）

#### 5.1.4 捕食システム
- **最小限の実装**:
  - プレイヤー間のサイズ比較（1.5倍以上の差で捕食可能）
  - 接触判定（TouchedイベントまたはRegion3）
  - 捕食時に大きいプレイヤーのサイズが+0.5成長
  - 小さいプレイヤーはリスポーン

#### 5.1.5 リスポーンシステム
- **最小限の実装**:
  - 固定のリスポーン地点（マップの中心付近）
  - リスポーン時にサイズを1.0にリセット
  - 3秒間の無敵時間（他のプレイヤーに捕食されない）

#### 5.1.6 UIシステム
- **最小限の実装**:
  - HUD（Fusion使用）:
    - 現在のサイズ表示（例: "Size: 2.5"）
    - 取得したアイテム数（例: "Items: 15"）
  - シンプルなデザイン（テキストのみでも可）

#### 5.1.7 マップ
- **最小限の実装**:
  - 平坦なベースプレート（512x512 studs）
  - 基本的な障害物（数個の壁や柱）
  - アイテムが生成される範囲を定義
  - リスポーンエリアのマーキング

#### 5.1.8 ネットワーキング
- **最小限の実装**:
  - プレイヤーの位置とサイズの同期（ReplicaまたはRemoteEvents）
  - アイテムの生成と取得の同期
  - 基本的なラグ補正

**MVPで実装しないもの（フェーズ2以降）**:
- ❌ 複数の毒生物タイプ選択
- ❌ 進化システム
- ❌ 特殊能力
- ❌ データ保存（ProfileStore）
- ❌ 統計・リーダーボード
- ❌ 複雑なマップエリア
- ❌ カスタマイズ機能
- ❌ 音響効果（BGM、効果音）

**MVPの成功基準**:
- ✅ プレイヤーが10分以上楽しめる
- ✅ 基本的なゲームループ（取得→成長→捕食/捕食される）が機能する
- ✅ 50人同時接続でクラッシュしない
- ✅ 平均FPSが30以上を維持
- ✅ 明らかなバグがない（クラッシュ、無限ループなど）

### 5.2 フェーズ2: コア機能実装
**期間**: 3-4週間

**目標**: 完全なゲーム体験を提供

**実装内容**:
- 複数の毒生物タイプ
- 進化システム
- マップの拡張
- データ保存機能
- パフォーマンス最適化

### 5.3 フェーズ3: 拡張機能
**期間**: 2-3週間

**目標**: ゲームの深みを追加

**実装内容**:
- 特殊能力システム
- 特別なエリア
- 統計とリーダーボード
- カスタマイズ機能
- バランス調整

### 5.4 フェーズ4: ポリッシュ
**期間**: 1-2週間

**目標**: リリース準備

**実装内容**:
- バグ修正
- UI/UX改善
- パフォーマンス最適化
- テストとデバッグ
- ドキュメント整備

## 6. ゲームバランス設定（初期値）

### 6.1 成長システム
- **初期サイズ**: 1.0（基準）
- **最大サイズ**: 10.0
- **毒アイテム取得時の成長**: +0.1
- **プレイヤー捕食時の成長**: +0.5（サイズ差が1.5倍以上の場合）

### 6.2 移動速度
- **基本速度**: 16 studs/s
- **サイズによる速度調整**: サイズが大きくなるほど速度が減少
- **速度計算式**: `speed = baseSpeed * (1 / size^0.3)`

### 6.3 毒アイテム生成
- **生成間隔**: 5-10秒
- **同時存在数**: 20-30個
- **生成範囲**: マップ全体

## 7. 将来の拡張案

### 7.1 ゲームモード
- バトルロイヤルモード
- チーム戦モード
- レースモード

### 7.2 カスタマイズ
- スキンシステム
- エモート
- パーティクルエフェクト

### 7.3 ソーシャル機能
- フレンドシステム
- ギルド/クラン
- イベントシステム

### 7.4 収益化
- ゲームパス
- デベロッパー製品
- 広告システム

## 8. リスクと対策

### 8.1 技術的リスク
- **パフォーマンス問題**: 早期のプロファイリングと最適化
- **同期問題**: 十分なテストとラグ補正の実装
- **データ損失**: ProfileStoreの適切な使用とエラーハンドリング

### 8.2 ゲームデザインリスク
- **バランス問題**: 継続的なテストと調整
- **プレイヤー離脱**: 早期フィードバック収集と改善

## 9. 成功指標（KPI）

### 9.1 エンゲージメント
- 平均プレイ時間: 15分以上
- リピート率: 30%以上
- 同時接続数: 50人以上

### 9.2 技術指標
- クラッシュ率: 1%以下
- 平均FPS: 45以上
- データ保存成功率: 99%以上

## 10. 参考文献・リソース

- [Roblox Developer Hub](https://create.roblox.com/)
- [Luau Documentation](https://luau-lang.org/)
- [Rojo Documentation](https://rojo.space/docs)
- [Wally Documentation](https://wally.run/)

---

**ドキュメント作成日**: 2024年
**バージョン**: 1.0
**ステータス**: 初期要件定義完了

